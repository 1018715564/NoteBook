# 数据库系统概论

> [数据库系统概论学习视频](https://www.bilibili.com/video/BV13J411J7Vu)
>
> 参考教程：数据库系统概论第五版（王珊、萨师煊）[PPT](https://github.com/wugenqiang/CS-Notes/tree/master/Resource/数据库系统概论/PPT)

?> 数据库系统概论目录介绍：

![image-20200419143250348](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419143251.png)

> 数据库系统概论（基础篇）

![image-20200419143340801](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419143342.png)

![image-20200419143434423](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419143435.png)

> 数据库系统概论（高级篇）

![image-20200419143521688](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419143523.png)

## 1 绪论

### 1.1 数据库系统概述

#### 1.1.1 四个基本概念

##### 1.1.1.1 数据

数据 Data

* 数据是数据库中存储的基本对象
* 数据的定义：描述事物的符号记录
* 数据的种类：数字、文字、图形、图像、音频、视频、学生的档案记录等
* 数据的含义称为数据的语义，数据与其语义是不可分的

##### 1.1.1.2 数据库

数据库 DataBase 简称 DB

* 数据库的定义：是长期储存在计算机内、有组织的、可共享的大量数据的集合
* 数据库的基本特征：
  * 数据按一定的数据模型组织、描述和储存
  * 可为各种用户共享
  * 冗余度较小
  * 数据独立性较高
  * 易扩展

##### 1.1.1.3 数据库管理系统

数据库管理系统 DataBase Management System 简称 DBMS

* 数据库管理系统的定义：位于用户与操作系统之间的一层数据管理软件，是基础软件，是一个大型复杂的软件系统 
* 用途：科学地组织和存储数据、高效地获取和维护数据

* 数据库在计算机系统中的位置：



![image-20200417155710379](../images/image-20200417155710379.png)

* 数据库管理系统的主要功能：

  * （1）数据定义功能

    * 提供数据定义语言（DDL）
    * 定义数据库中的数据对象
  * （2）数据组织、存储和管理
    * 分类组织、存储和管理各种数据	
    * 确定组织数据的文件结构和存取方式
    * 实现数据之间的联系
  
    * 提供多种存取方法提高存取效率
  * （3）数据操纵功能
    * 提供数据操纵语言（DML）
    * 实现对数据库的基本操作  （查询、插入、删除和修改）
  * （4）数据库的事务管理和运行管理
    * 数据库在建立、运行和维护时由数据库管理系统统一管理和控制
    * 保证数据的安全性、完整性、多用户对数据的并发使用
    * 发生故障后的系统恢复
  * （5）数据库的建立和维护功能
    * 提供实用程序、工具，完成数据库初始数据的装载和转换
    * 数据库转储、恢复功能
    * 数据库的重组织
    * 性能监视、分析等
  * （6）其它功能
    * 数据库管理系统与网络中其它软件系统的通信
    * 数据库管理系统系统之间的数据转换
    * 异构数据库之间的互访和互操作

##### 1.1.1.4 数据库系统

数据库系统 DataBase 简称 DBS

* 数据库系统的定义：是指在计算机系统中引入数据库后的系统构成
* 在不引起混淆的情况下，常常把数据库系统简称为数据库
* 数据库系统的构成：
  * 数据库
  * 数据库管理系统（及其应用开发工具）
  * 应用程序
  * 数据库管理员 (DataBase Administrator，简称 DBA)



![image-20200417161100305](../images/image-20200417161100305.png)

#### 1.1.2 数据管理技术的产生和发展

##### 1.1.2.1 数据管理

数据管理的定义：

* 对数据进行分类、组织、编码、存储、检索和维护
* 数据处理的中心问题

数据管理技术的发展过程

* 人工管理阶段（20 世纪 50 年代中之前）
* 文件系统阶段（20 世纪 50 年代末 -- 60 年代中）
* 数据库系统阶段（20 世纪 60 年代末 -- 现在）

三个发展阶段的比较：

![image-20200417161912580](../images/image-20200417161912580.png)

#### 1.1.3 数据库系统的特点

* 数据结构化
* 数据的共享性高，冗余度低且易扩充
* 数据独立性高
* 数据由数据库管理系统统一管理和控制

举例：用数据库系统实现学籍管理

![image-20200417163459924](../images/image-20200417163459924.png)



### 1.2 数据模型

* 数据模型是对现实世界数据特征的抽象。

* 通俗地讲数据模型就是现实世界的模拟。
* 数据模型应满足三方面要求
  * 能比较真实地模拟现实世界
  * 容易为人所理解
  * 便于在计算机上实现
* 数据模型是数据库系统的核心和基础

#### 1.2.1 两类数据模型

数据模型分为两类（两个不同的层次）

![image-20200417164409859](../images/image-20200417164409859.png)

#### 1.2.2 概念模型

概念模型的用途

* 概念模型用于信息世界的建模
* 是现实世界到机器世界的一个中间层次
* 是数据库设计的有力工具
* 数据库设计人员和用户之间进行交流的语言

对概念模型的基本要求

* 较强的语义表达能力
* 简单、清晰、易于用户理解

概念模型的一种表示方法：`实体-联系方法`

##### 1.2.2.1 信息世界中的基本概念

（1）实体（Entity） 

客观存在并可相互区别的事物称为实体。

可以是具体的人、事、物或抽象的概念。

（2）属性（Attribute） 

实体所具有的某一特性称为属性。

一个实体可以由若干个属性来刻画。  

（3）码（Key） 

唯一标识实体的属性集称为码。

（4）实体型（Entity Type） 

用实体名及其属性名集合来抽象和刻画同类实体称为实体型

（5）实体集（Entity Set） 

同一类型实体的集合称为实体集

（6）联系（Relationship）  

现实世界中事物内部以及事物之间的联系在信息世界中反映为实体（型）内部的联系和实体（型）之间的联系。

实体内部的联系通常是指组成实体的各属性之间的联系

实体之间的联系通常是指不同实体集之间的联系

实体之间的联系有一对一（1:1）、一对多（1：m）和多对多（m：n）等多种类型

![image-20200417165354243](../images/image-20200417165354243.png)

##### 1.2.2.2 实体 - 联系方法

实体-联系方法（Entity-Relationship Approach）

* 用E-R图来描述现实世界的概念模型
* E-R方法也称为E-R模型

![image-20200417165608648](../images/image-20200417165608648.png)

#### 1.2.3 数据模型的组成要素

* 数据结构：描述系统的静态特性
* 数据操作 ：描述系统的动态特性
* 数据的完整性约束条件

##### 1.2.3.1 数据结构

描述数据库的组成对象，以及对象之间的联系

描述的内容

* 与对象的类型、内容、性质有关
* 与数据之间联系有关



##### 1.2.3.2 数据操作

数据操作

* 对数据库中各种对象（型）的实例（值）允许执行的操作的集合，包括操作及有关的操作规则

数据操作的类型

* 查询
* 更新（包括插入、删除、修改）

数据模型对操作的定义

* 操作的确切含义
* 操作符号
* 操作规则（如优先级）
* 实现操作的语言

##### 1.2.3.3 数据的完整性约束条件

数据的完整性约束条件

* 一组完整性规则的集合
  * 完整性规则：给定的数据模型中数据及其联系所具有的制约和依存规则
  * 用以限定符合数据模型的数据库状态以及状态的变化，以保证数据的正确、有效和相容
* 数据模型对完整性约束条件的定义
  * 反映和规定必须遵守的基本的通用的完整性约束条件。
  * 提供定义完整性约束条件的机制，以反映具体应用所涉及的数据必须遵守的特定的语义约束条件。

#### 1.2.4 常用的数据模型

![image-20200417170922132](../images/image-20200417170922132.png)

#### 1.2.5 层次模型

![image-20200417171344847](../images/image-20200417171344847.png)

##### 1.2.5.1 层次模型的数据结构

![image-20200417171529018](../images/image-20200417171529018.png)

##### 1.2.5.2 数据操纵与完整性约束

层次模型的数据操纵

* 查询
* 插入
* 删除
* 更新 

层次模型的完整性约束条件 

* 无相应的双亲结点值就不能插入子女结点值
* 如果删除双亲结点值，则相应的子女结点值也被同时删除
* 更新操作时，应更新所有相应记录，以保证数据的一致性

##### 1.2.5.3 层次结构的优缺点

优点

* 层次模型的数据结构比较简单清晰 
* 查询效率高，性能优于关系模型，不低于网状模型
* 层次数据模型提供了良好的完整性支持

缺点

* 结点之间的多对多联系表示不自然
* 对插入和删除操作的限制多，应用程序的编写比较复杂 
* 查询子女结点必须通过双亲结点
* 层次命令趋于程序化 

#### 1.2.6 网状模型

![image-20200417172343027](../images/image-20200417172343027.png)

##### 1.2.6.1 网状模型的数据结构

![image-20200417172459915](../images/image-20200417172459915.png)

![image-20200417172719107](../images/image-20200417172719107.png)

##### 1.2.6.2 操纵与完整性约束

![image-20200417173529526](../images/image-20200417173529526.png)

##### 1.2.6.3 网状模型的优缺点

优点

* 能够更为直接地描述现实世界，如一个结点可以有多个双亲
* 具有良好的性能，存取效率较高

缺点

* 结构比较复杂，而且随着应用环境的扩大，数据库的结构就变得越来越复杂，不利于最终用户掌握
* DDL、DML语言复杂，用户不容易使用
  记录之间联系是通过存取路径实现的，用户必须了解系统结构的细节

#### 1.2.7 关系模型

![image-20200417173737953](../images/image-20200417173737953.png)

##### 1.2.7.1 关系模型的数据结构

关系（Relation）

* 一个关系对应通常说的一张表

元组（Tuple）

* 表中的一行即为一个元组

属性（Attribute）

* 表中的一列即为一个属性，给每一个属性起一个名称即属性名

主码（Key）

* 也称码键。表中的某个属性组，它可以唯一确定一个元组

域（Domain）

* 是一组具有相同数据类型的值的集合。属性的取值范围来自某个域。

分量

* 元组中的一个属性值。

关系模式

* 对关系的描述
* 关系名（属性1，属性2，…，属性n）
* 学生（学号，姓名，年龄，性别，系名，年级）

![image-20200417174048827](../images/image-20200417174048827.png)

![image-20200417174119872](../images/image-20200417174119872.png)

##### 1.2.7.2 操纵与完整性约束

数据操作是集合操作，操作对象和操作结果都是关系

* 查询
* 插入
* 删除
* 更新

存取路径对用户隐蔽，用户只要指出“干什么”，不必详细说明“怎么干”

![image-20200417174246213](../images/image-20200417174246213.png)

![image-20200417174325947](../images/image-20200417174325947.png)

##### 1.2.7.3 关系模型的优缺点

优点

* 建立在严格的数学概念的基础上
* 概念单一
  * 实体和各类联系都用关系来表示
  * 对数据的检索结果也是关系
* 关系模型的存取路径对用户透明
  * 具有更高的数据独立性，更好的安全保密性
  * 简化了程序员的工作和数据库开发建立的工作

缺点

* 存取路径对用户透明，查询效率往往不如格式化数据模型
* 为提高性能，必须对用户的查询请求进行优化，增加了开发数据库管理系统的难度



### 1.3 数据库系统的结构

* 从数据库应用开发人员角度看，数据库系统通常采用三级模式结构，是数据库系统内部的系统结构 

* 从数据库最终用户角度看，数据库系统的结构分为:
  * 单用户结构
  * 主从式结构
  * 分布式结构
  * 客户-服务器
  * 浏览器-应用服务器／数据库服务器多层结构等

#### 1.3.1 数据库系统模式的概念

![image-20200417174822811](../images/image-20200417174822811.png)

![image-20200417174919345](../images/image-20200417174919345.png)

举例：

![image-20200417175111102](../images/image-20200417175111102.png)

#### 1.3.2 三级模式结构

* 模式（Schema） 
* 外模式（External Schema）
* 内模式（Internal Schema） 

![image-20200417175512928](../images/image-20200417175512928.png)

##### 1.3.2.1 模式（Schema）

![image-20200417175655342](../images/image-20200417175655342.png)

##### 1.3.2.2 外模式（External Schema）

![image-20200417175926373](../images/image-20200417175926373.png)

##### 1.3.2.3 内模式（Internal Schema） 

![image-20200417180112343](../images/image-20200417180112343.png)

#### 1.3.3 数据库的二级映像功能与数据独立性 

> 映像（mapping）

![image-20200417180412343](../images/image-20200417180412343.png)

##### 1.3.3.1 外模式／模式映像

![image-20200417180546748](../images/image-20200417180546748.png)

##### 1.3.3.2 模式／内模式映像

![image-20200417180716831](../images/image-20200417180716831.png)

##### 1.3.3.3 总结

数据库的二级映像功能与数据独立性特点：

![image-20200417180843065](../images/image-20200417180843065.png)

### 1.4 数据库系统的组成

![image-20200417181155205](../images/image-20200417181155205.png)

![image-20200417181416244](../images/image-20200417181416244.png)

数据库管理员（DBA）

![image-20200417181741946](../images/image-20200417181741946.png)

![image-20200417181932700](../images/image-20200417181932700.png)

用户：

![image-20200417182020258](../images/image-20200417182020258.png)



## 2 关系数据库

### 2.1 关系数据库及形式化定义

![image-20200418095403380](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418095405.png)

#### 2.1.1 关系

单一的数据结构----关系

* 现实世界的实体以及实体间的各种联系均用关系来表示

逻辑结构----二维表 

* 从用户角度，关系模型中数据的逻辑结构是一张二维表

建立在集合代数的基础上

##### 2.1.1.1 域（Domain）

域是一组具有相同数据类型的值的集合。例:

* 整数
* 实数
* 介于某个取值范围的整数
* 指定长度的字符串集合
* {‘男’，‘女’}
* ……………..

##### 2.1.1.2 笛卡尔积（Cartesian Product）

![image-20200418083356378](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418083403.png)

![image-20200418084356954](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084402.png)

![image-20200418084459525](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084500.png)

举例：

![image-20200418084616071](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084617.png)

![image-20200418084718156](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084719.png)

![image-20200418084825312](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084826.png)

##### 2.1.1.3 关系（Relation）

![image-20200418084921480](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084923.png)

![image-20200418084945091](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418084946.png)

![image-20200418085029330](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085030.png)

![image-20200418085100502](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085102.png)

![image-20200418085132090](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085133.png)

![image-20200418085410611](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085412.png)

![image-20200418085511225](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085512.png)

![image-20200418085526600](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085528.png)

![image-20200418085611180](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085612.png)



#### 2.1.2 关系模式

##### 2.1.2.1 什么是关系模式

![image-20200418085655900](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085657.png)

##### 2.1.2.2 定义关系模式

![image-20200418085716647](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085717.png)

![image-20200418085802571](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085804.png)

![image-20200418085843879](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085844.png)

##### 2.1.2.3 关系模式与关系

![image-20200418085926251](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418085927.png)



#### 2.1.3 关系数据库

![image-20200418090124014](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090125.png)



#### 2.1.4 关系模型的存储结构

![image-20200418090203905](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090205.png)



### 2.2 关系操作

#### 2.2.1 基本的关系操作

![image-20200418090252385](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090253.png)

#### 2.2.2 关系数据库语言的分类

![image-20200418090349855](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090351.png)



### 2.3 关系的完整性

> 关系的三类完整性约束

![image-20200418090431876](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090433.png)

#### 2.3.1 实体完整性

![image-20200418090646514](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090647.png)

![image-20200418090852432](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090853.png)

#### 2.3.2 参照完整性

##### 2.3.2.1 关系间的引用

![image-20200418090948358](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418090950.png)

![image-20200418091041361](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091042.png)

![image-20200418091314934](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091316.png)

##### 2.3.2.2 外码（Foreign Key）

![image-20200418091416378](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091417.png)

![image-20200418091436883](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091437.png)

![image-20200418091455079](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091456.png)

![image-20200418091517643](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091519.png)

![image-20200418091533414](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091534.png)

##### 2.3.2.3 参照完整性规则

![image-20200418091613322](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091614.png)

![image-20200418091629788](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091631.png)

![image-20200418091649112](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091650.png)

![image-20200418091705370](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091706.png)

#### 2.3.3 用户定义的完整性

![image-20200418091739782](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091740.png)

![image-20200418091756377](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091757.png)



### 2.4 关系代数

![image-20200418091855261](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091856.png)

![image-20200418091922823](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418091923.png)

#### 2.4.1 传统的集合运算

##### 2.4.1.1 并（Union）

![image-20200418092116624](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418092117.png)

![image-20200418092137245](https://gitee.com//wugenqiang/PictureBed/raw/master/CS-Notes/20200418092139.png)

##### 2.4.1.2 差（Difference）

![image-20200418092407057](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092409.png)

![image-20200418092522459](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092524.png)

##### 2.4.1.3 交（Intersection）

![image-20200418092618539](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092621.png)

![image-20200418092640842](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092642.png)

##### 2.4.1.4 笛卡尔积（Cartesian Product）

![image-20200418092743198](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092744.png)

![image-20200418092904981](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092906.png)



#### 2.4.2 专门的关系运算

![image-20200418092923927](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418092925.png)

![image-20200418093017938](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093018.png)

![image-20200418093032074](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093033.png)

![image-20200418093050759](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093052.png)

![image-20200418093221548](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093222.png)



![image-20200418093453302](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093454.png)

![image-20200418093507337](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093508.png)

![image-20200418093526236](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093527.png)

##### 2.4.2.1 选择（Selection）

![image-20200418093639595](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093640.png)

![image-20200418093700126](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093701.png)

![image-20200418093725086](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093726.png)

![image-20200418093741703](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093743.png)

##### 2.4.2.2 投影（Projection） 

![image-20200418093907297](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093908.png)

![image-20200418093941961](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418093957.png)

![image-20200418094058716](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094059.png)

##### 2.4.2.3 连接（Join） 

![image-20200418094139012](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094140.png)

![image-20200418094154380](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094156.png)

![image-20200418094215132](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094216.png)

![image-20200418094252250](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094253.png)

![image-20200418094306534](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094307.png)

![image-20200418094322503](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094323.png)

![image-20200418094338857](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094340.png)

![image-20200418094401059](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094402.png)

![image-20200418094422620](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094423.png)

![image-20200418094442585](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094443.png)

![image-20200418094458971](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094500.png)

![image-20200418094519340](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094520.png)

##### 2.4.2.4 除运算（Division）

![image-20200418094603407](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094604.png)

![image-20200418094624528](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094625.png)

![image-20200418094638741](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094639.png)

![image-20200418094654898](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094655.png)

#### 2.4 3 综合举例

![image-20200418094742857](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094744.png)

![image-20200418094800952](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094802.png)

![image-20200418094817024](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418094818.png)

### 2.5 关系演算（*）

> 这部分了解即可，无需深入

* 关系演算语言
  * 元组关系演算语言：ALPHA
  * 域关系演算语言：QBE

![image-20200418095739836](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418095741.png)

#### 2.5.1 元组关系演算语言：ALPHA

![image-20200418095817322](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418095818.png)

##### 2.5.1.1 简单检索

![image-20200418095935841](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418095936.png)

W 指的是工作空间名

##### 2.5.1.2 限定的检索

![image-20200418100043238](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100044.png)

##### 2.5.1.3 带排序的检索

![image-20200418100121202](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100122.png)

##### 2.5.1.4 带定额的检索

![image-20200418100204083](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100205.png)

##### 2.5.1.5 用元组变量的检索

![image-20200418100242036](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100243.png)

##### 2.5.1.6 用存在量词的检索

![image-20200418100329721](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100330.png)

![image-20200418100711432](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100712.png)

##### 2.5.1.7 带有多个关系的表达式的检索

![image-20200418100824582](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100825.png)

##### 2.5.1.8 用量词的检索

![image-20200418100926412](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418100927.png)

* 用全称量词的检索

![image-20200418101023913](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101025.png)

##### 2.5.1.9 用两种量词的检索

![image-20200418101132231](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101133.png)

##### 2.5.1.10 用蕴含（Implication）的检索

![image-20200418101246084](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101247.png)

##### 2.5.1.11 聚集函数

![image-20200418101325639](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101327.png)

![image-20200418101343327](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101344.png)

#### 2.5.2 域关系演算语言：QBE

![image-20200418101527990](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418101529.png)



## 3 SQL 语言

> 关系数据库标准语言 SQL

![image-20200418105317156](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105318.png)

### 3.1 SQL 概述

SQL（Structured Query Language）

* 结构化查询语言，是关系数据库的标准语言

SQL 是一个通用的、功能极强的关系数据库语言



#### 3.1.1  SQL 的产生与发展

![image-20200418104716559](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418104717.png)

#### 3.1.2  SQL 的特点

（1）特点一：综合统一

![image-20200418104732863](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418104733.png)

（2）特点二：高度非过程化

![image-20200418104906467](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418104908.png)

（3）特点三：面向集合的操作方式

![image-20200418104937134](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418104938.png)

（4）特点四：以同一种语法结构提供多种使用方式

![image-20200418105006192](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105007.png)

（5）特点五：语言简洁，易学易用

![image-20200418105040833](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105042.png)



#### 3.1.3  SQL 的基本概念

![image-20200418105059420](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105100.png)

![image-20200418105112188](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105113.png)

![image-20200418105125057](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105126.png)

![image-20200418105136766](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105138.png)

SQL 的简单说明：

模式定义了数据如何存储、存储什么样的数据以及数据如何分解等信息，数据库和表都有模式。

主键的值不允许修改，也不允许复用（不能使用已经删除的主键值赋给新数据行的主键）。

SQL（Structured Query Language)，标准 SQL 由 ANSI 标准委员会管理，从而称为 ANSI SQL。各个 DBMS 都有自己的实现，如 PL/SQL、Transact-SQL 等。

SQL 语句不区分大小写，但是数据库表名、列名和值是否区分依赖于具体的 DBMS 以及配置。

SQL 支持以下三种注释：

```sql
# 注释
SELECT *
FROM mytable; -- 注释
/* 注释1
   注释2 */
```

数据库创建与使用：

```sql
CREATE DATABASE test;
USE test;
```



### 3.2 学生 - 课程数据库

![image-20200418105225865](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418105227.png)

Student 表

![image-20200418110414426](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418110415.png)

Course 表

![image-20200418110451241](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418110452.png)

SC 表

![image-20200418110512511](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418110513.png)

### 3.3 数据定义

![image-20200418110842309](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418110843.png)

模式：

![image-20200418110919968](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418110921.png)

#### 3.3.1 模式定义与删除

（1）定义模式

![image-20200418111026019](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111027.png)

![image-20200418111044520](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111045.png)

![image-20200418111058226](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111059.png)

（2）删除模式

![image-20200418111122510](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111123.png)

![image-20200418111136818](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111137.png)

#### 3.3.2 基本表的定义与基本操作

3.3.2.1 创建表

![image-20200418111204778](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111205.png)

```sql
CREATE TABLE mytable (
  id INT NOT NULL AUTO_INCREMENT,
  col1 INT NOT NULL DEFAULT 1,
  col2 VARCHAR(45) NULL,
  col3 DATE NULL,
  PRIMARY KEY (`id`));
```



学生表 Student

![image-20200418111226445](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111227.png)

课程表 Course

![image-20200418111250576](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111251.png)

学生选课表 SC

![image-20200418111314417](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111315.png)

3.3.2.2 数据类型

![image-20200418111855454](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111856.png)

![image-20200418111916646](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111917.png)

3.3.2.3 模式与表

![image-20200418111943881](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418111944.png)

![image-20200418112002638](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112003.png)

![image-20200418112017419](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112018.png)

3.3.2.4 修改表

![image-20200418112045845](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112046.png)

![image-20200418112215227](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112216.png)

添加列

```sql
ALTER TABLE mytable
ADD col CHAR(20);
```

删除列

```sql
ALTER TABLE mytable
DROP COLUMN col;
```

删除表

```sql
DROP TABLE mytable;
```

![image-20200418112249561](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112250.png)

![image-20200418112338934](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112339.png)

3.3.2.5 插入表

普通插入

```sql
INSERT INTO mytable(col1, col2)
VALUES(val1, val2);
```

插入检索出来的数据

```sql
INSERT INTO mytable1(col1, col2)
SELECT col1, col2
FROM mytable2;
```

将一个表的内容插入到一个新表

```sql
CREATE TABLE newtable AS
SELECT * FROM mytable;
```

3.3.2.6 更新表

```sql
UPDATE mytable
SET col = val
WHERE id = 1;
```

3.3.2.7 删除表

![image-20200418112421710](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112422.png)

```sql
DELETE FROM mytable
WHERE id = 1;
```

**TRUNCATE TABLE**  可以清空表，也就是删除所有行。

```sql
TRUNCATE TABLE mytable;
```

使用更新和删除操作时一定要用 WHERE 子句，不然会把整张表的数据都破坏。可以先用 SELECT 语句进行测试，防止错误删除。

![image-20200418112511554](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112512.png)

![image-20200418112533545](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112534.png)

![image-20200418112929447](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112930.png)

![image-20200418112948299](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418112949.png)

3.3.2.8 查询表

> DISTINCT

相同值只会出现一次。它作用于所有列，也就是说所有列的值都相同才算相同。

```sql
SELECT DISTINCT col1, col2
FROM mytable;
```

> LIMIT

限制返回的行数。可以有两个参数，第一个参数为起始行，从 0 开始；第二个参数为返回的总行数。

返回前 5 行：

```sql
SELECT *
FROM mytable
LIMIT 5;
```

```sql
SELECT *
FROM mytable
LIMIT 0, 5;
```

返回第 3 \~ 5 行：

```sql
SELECT *
FROM mytable
LIMIT 2, 3;
```

3.3.2.9 排序

-  **ASC** ：升序（默认）
-  **DESC** ：降序

可以按多个列进行排序，并且为每个列指定不同的排序方式：

```sql
SELECT *
FROM mytable
ORDER BY col1 DESC, col2 ASC;
```

#### 3.3.3 索引的建立、修改与删除

![image-20200418113354154](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113355.png)

3.3.3.1 建立索引

![image-20200418113418222](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113420.png)

![image-20200418113446820](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113447.png)

![image-20200418113519144](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113520.png)

3.3.3.2 修改索引

![image-20200418113544887](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113546.png)

3.3.3.3 删除索引

![image-20200418113619290](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113620.png)

#### 3.3.4 数据字典

![image-20200418113645511](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113646.png)

### 3.4 数据查询

![image-20200418113746448](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113747.png)

![image-20200418113801963](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418113802.png)

#### 3.4.1 单表查询

![image-20200418114039469](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114040.png)

##### 3.4.1.1 选择表中的若干列

![image-20200418114132594](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114133.png)

![image-20200418114145363](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114146.png)

![image-20200418114213934](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114215.png)

![image-20200418114229538](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114230.png)

![image-20200418114243257](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114244.png)

##### 3.4.1.2 选择表中的若干元组

![image-20200418114324194](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114325.png)

![image-20200418114338481](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114339.png)

![image-20200418114354168](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114355.png)

* 比较大小

![image-20200418114409205](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114410.png)

* 确定范围

![image-20200418114441149](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114442.png)

* 确定集合

![image-20200418114501243](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114502.png)

* 字符匹配

![image-20200418114521027](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114522.png)

![image-20200418114534226](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114535.png)

![image-20200418114553178](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114554.png)

![image-20200418114605951](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114607.png)

![image-20200418114618428](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114619.png)

* 涉及空值的查询

![image-20200418114643752](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114644.png)

* 多重条件查询

![image-20200418114709550](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114711.png)

![image-20200418114728489](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114729.png)

##### 3.4.1.3 ORDER BY 子句

![image-20200418114813548](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114814.png)

![image-20200418114827754](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114829.png)

##### 3.4.1.4 聚集函数

![image-20200418114906839](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114908.png)

![image-20200418114922065](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114923.png)

![image-20200418114937145](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418114938.png)

##### 3.4.1.5 GROUP BY 子句 

![image-20200418115148670](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115149.png)

![image-20200418115202857](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115204.png)

![image-20200418115219552](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115220.png)

![image-20200418115253777](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115254.png)

![image-20200418115306125](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115307.png)



#### 3.4.2 连接查询

![image-20200418115402141](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115403.png)

##### 3.4.2.1 等值与非等值连接查询 

![image-20200418115433284](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418115434.png)

![image-20200418201811514](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418201812.png)

> 连接操作的执行过程

![image-20200418201917336](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418201918.png)

![image-20200418201934636](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418201935.png)

![image-20200418202008026](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202009.png)

![image-20200418202019868](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202021.png)

![image-20200418202040151](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202041.png)

![image-20200418202137941](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202138.png)

##### 3.4.2.2 自身连接

![image-20200418202222537](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202223.png)

![image-20200418202400699](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202401.png)

![image-20200418202424748](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202425.png)

##### 3.4.2.3 外连接

![image-20200418202541563](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202542.png)

![image-20200418202608479](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202609.png)

![image-20200418202623093](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202624.png)

##### 3.4.2.4 多表连接

![image-20200418202701133](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418202703.png)



#### 3.4.3 嵌套查询

![image-20200418203716669](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418203717.png)

![image-20200418203738665](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418203739.png)

![image-20200418203752312](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418203753.png)

![image-20200418203809289](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418203810.png)

##### 3.4.3.1 带有 IN 谓词的子查询 

![image-20200418204032798](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204034.png)

![image-20200418204051271](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204052.png)

![image-20200418204134777](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204136.png)

![image-20200418204150438](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204151.png)

![image-20200418204244255](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204245.png)

![image-20200418204301956](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204303.png)

##### 3.4.3.2 带有比较运算符的子查询

![image-20200418204336827](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418204338.png)

![image-20200418205744609](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205745.png)

![image-20200418205758332](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205759.png)

![image-20200418205811068](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205812.png)

![image-20200418205824770](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205825.png)

##### 3.4.3.3 带有 ANY（SOME）或 ALL 谓词的子查询

![image-20200418205858531](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205859.png)

![image-20200418205948097](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418205949.png)

![image-20200418210000615](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210001.png)

![image-20200418210013113](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210014.png)

![image-20200418210026271](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210027.png)

![image-20200418210044911](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210046.png)

![image-20200418210056531](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210057.png)

![image-20200418210110608](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210111.png)

##### 3.4.3.4 带有 EXISTS 谓词的子查询

![image-20200418210141635](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210142.png)

![image-20200418210151988](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210153.png)

![image-20200418210204741](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210205.png)

![image-20200418210217306](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210218.png)

![image-20200418210231907](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210233.png)

![image-20200418210248524](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210249.png)

![image-20200418210315288](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210316.png)

![image-20200418210331889](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210333.png)

![image-20200418210344980](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210345.png)

![image-20200418210358384](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210359.png)

![image-20200418210410904](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210411.png)



#### 3.4.4 集合查询

![image-20200418210430120](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210431.png)

![image-20200418210448531](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210449.png)

![image-20200418210544850](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210546.png)

![image-20200418210603948](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210605.png)

![image-20200418210617204](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210618.png)

![image-20200418210629393](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210630.png)

![image-20200418210643548](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210644.png)

![image-20200418210657924](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210659.png)

![image-20200418210712167](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210713.png)



#### 3.4.5基于派生表的查询

![image-20200418210743561](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210744.png)

![image-20200418210826011](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210826.png)



#### 3.4.6 Select语句的一般形式 

![image-20200418210841741](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210842.png)



##### 3.4.6.1 目标列表达式的可选格式

![image-20200418210855411](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418210856.png)

##### 3.4.6.2 聚集函数的一般格式

![image-20200418211007789](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211011.png)



##### 3.4.6.3 WHERE 子句的条件表达式的可选格式

![image-20200418211121798](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211123.png)

![image-20200418211136125](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211137.png)

![image-20200418211149064](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211150.png)

### 3.5 数据更新

#### 3.5.1  插入数据

![image-20200418211403710](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211404.png)

##### 3.5.1.1 插入元组

![image-20200418211434802](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211436.png)

 INTO 子句

* 指定要插入数据的表名及属性列
* 属性列的顺序可与表定义中的顺序不一致
* 没有指定属性列：表示要插入的是一条完整的元组，且属性列属性与表定义中的顺序一致
* 指定部分属性列：插入的元组在其余属性列上取空值

VALUES 子句

* 提供的值必须与INTO子句匹配
  * 值的个数
  * 值的类型

![image-20200418211528912](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211530.png)

![image-20200418211552985](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211554.png)

![image-20200418211606952](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211608.png)

##### 3.5.1.2 插入子查询结果

![image-20200418211619308](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211620.png)

![image-20200418211708066](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211709.png)

![image-20200418211722086](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211723.png)

#### 3.5.2  修改数据

![image-20200418211739967](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211741.png)

![image-20200418211752471](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211753.png)

##### 3.5.2.1 修改某一个元组的值

![image-20200418211821736](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211822.png)

##### 3.5.2.2 修改多个元组的值

![image-20200418211836277](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211837.png)

##### 3.5.2.3 带子查询的修改语句

![image-20200418211925729](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418211926.png)



#### 3.5.3  删除数据

![image-20200418212011121](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212012.png)

![image-20200418212029202](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212030.png)

##### 3.5.3.1 删除某一个元组的值

![image-20200418212104590](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212105.png)

##### 3.5.3.2 删除多个元组的值

![image-20200418212137738](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212139.png)

##### 3.5.3.3 带子查询的删除语句

![image-20200418212202395](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212203.png)



### 3.6 空值的处理

![image-20200418212216938](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212217.png)

#### 3.6.1 空值的产生

![image-20200418212244965](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212246.png)

![image-20200418212257344](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212258.png)

#### 3.6.2 空值的判断

![image-20200418212321469](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212322.png)

#### 3.6.3 空值的约束条件

![image-20200418212346671](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212347.png)

#### 3.6.4 空值的算术运算、比较运算和逻辑运算

![image-20200418212410338](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212411.png)

![image-20200418212425347](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212426.png)

![image-20200418212437776](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212439.png)

![image-20200418212452589](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212453.png)



### 3.7 视图

![image-20200418212505910](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212506.png)

#### 3.7.1  定义视图

##### 3.7.1.1 建立视图

![image-20200418212628131](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212629.png)

![image-20200418212640909](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212642.png)

![image-20200418212654274](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212655.png)

![image-20200418212705699](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212706.png)

![image-20200418212717411](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212718.png)

![image-20200418212728936](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212730.png)

![image-20200418212742687](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212743.png)

![image-20200418212754092](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212755.png)

![image-20200418212806631](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212807.png)

![image-20200418212818845](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212820.png)

![image-20200418212829103](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212830.png)

![image-20200418212841797](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212842.png)

##### 3.7.1.2 删除视图

![image-20200418212852063](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212853.png)

![image-20200418212906380](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212907.png)

#### 3.7.2  查询视图

![image-20200418212920290](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212921.png)

![image-20200418212932452](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212933.png)

![image-20200418212947202](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418212948.png)

![image-20200418213001999](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213003.png)

![image-20200418213211213](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213212.png)

![image-20200418213224452](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213225.png)



#### 3.7.3  更新视图

![image-20200418213237605](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213238.png)

![image-20200418213251191](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213252.png)

![image-20200418213304001](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213305.png)

![image-20200418213317068](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213318.png)

![image-20200418213330140](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213331.png)

![image-20200418213342952](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213344.png)

![image-20200418213355296](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213356.png)



#### 3.7.4  视图的作用

![image-20200418213413335](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213414.png)

![image-20200418213425710](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213427.png)

![image-20200418213438074](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213439.png)

![image-20200418213448724](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213449.png)

![image-20200418213507412](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213508.png)

![image-20200418213522750](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213524.png)

![image-20200418213536021](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213537.png)

![image-20200418213548499](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200418213549.png)



## 4 数据库安全性

![image-20200419102616365](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419102617.png)

![image-20200419102649256](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419102650.png)

### 4.1  数据库安全性概述

#### 4.1.1 数据库的不安全因素



![image-20200419102922133](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419102923.png)

![image-20200419102937247](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419102938.png)

![image-20200419103015237](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103016.png)



#### 4.1.2 安全标准简介

![image-20200419103028813](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103029.png)

![image-20200419103151168](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103152.png)

![image-20200419103105468](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103106.png)

* TCSEC 标准

![image-20200419103237401](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103238.png)

![image-20200419103254509](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103256.png)

![image-20200419103321480](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103322.png)

![image-20200419103505910](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103507.png)

![image-20200419103407119](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103408.png)

![image-20200419103523664](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103524.png)

![image-20200419103533986](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103535.png)

![image-20200419103548320](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103549.png)

![image-20200419103558293](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103559.png)

![image-20200419103613000](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103614.png)



* CC 标准

![image-20200419103628862](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103630.png)

![image-20200419103642782](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103644.png)

![image-20200419103653889](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419103655.png)

> 自上而下保证程度逐渐增高。



### 4.2  数据库安全性控制

![image-20200419104330246](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104331.png)

![image-20200419104342507](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104343.png)

![image-20200419104357643](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104358.png)

![image-20200419104417754](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104419.png)

![image-20200419104432481](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104433.png)

![image-20200419104444502](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104445.png)

#### 4.2.1 用户身份鉴别

![image-20200419104812735](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104813.png)

![image-20200419104825730](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104826.png)

#### 4.2.2 存取控制

![image-20200419104844104](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104845.png)

![image-20200419104916751](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104918.png)

![image-20200419104928017](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104929.png)



#### 4.2.3 自主存取控制方法

![image-20200419104943021](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104944.png)

![image-20200419104958232](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419104959.png)

#### 4.2.4 授权：授予与回收

![image-20200419105012745](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105014.png)

![image-20200419105025752](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105026.png)

![image-20200419105038907](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105040.png)

![image-20200419105052528](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105053.png)

![image-20200419105104022](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105105.png)

![image-20200419105116391](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105117.png)

![image-20200419105128952](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105130.png)

![image-20200419105141357](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105142.png)

![image-20200419105211004](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105212.png)

![image-20200419105224854](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105225.png)

![image-20200419105237989](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105239.png)

* CASCADE：级联回收
* RESTRICT：受限回收

![image-20200419105248682](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105249.png)

![image-20200419105301141](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105302.png)

![image-20200419105312685](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105313.png)

![image-20200419105326978](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105328.png)

> SQL 灵活的授权机制

![image-20200419105359985](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105401.png)

![image-20200419105422621](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105423.png)

![image-20200419105940828](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105942.png)

![image-20200419105439553](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105440.png)

![image-20200419105450693](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105451.png)

![image-20200419105502094](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105503.png)



#### 4.2.5 数据库角色

![image-20200419105520266](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105521.png)

> 注：使用角色来管理数据库权限，可以简化授权和回收的过程。



![image-20200419105532434](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105533.png)

![image-20200419105544531](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105545.png)

> 指定 WITH ADMIN OPTION，则获得权限的角色或用户还可以把这种权限授予其他角色。



![image-20200419105556191](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419105557.png)

![image-20200419110700326](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110701.png)

![image-20200419110711318](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110712.png)

![image-20200419110723720](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110724.png)

![image-20200419110736260](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110737.png)

> 自主存取控制缺点：

![image-20200419111137828](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111139.png)

#### 4.2.6 强制存取控制方法

![image-20200419110925263](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110926.png)

![image-20200419110936104](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110937.png)

![image-20200419110948749](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419110949.png)

![image-20200419110959789](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111000.png)

![image-20200419111411889](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111413.png)

![image-20200419111444404](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111445.png)

![image-20200419111535701](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111536.png)



![image-20200419111021501](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111022.png)

举例：

![image-20200419111647873](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111649.png)

> DAC + MAC 安全检查

![image-20200419111038294](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111039.png)

> 小结：

![image-20200419111759737](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111801.png)



### 4.3  视图机制

![image-20200419111854014](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111855.png)

![image-20200419111940684](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419111941.png)

![image-20200419112018326](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112019.png)

![image-20200419112032087](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112033.png)



### 4.4  审计（Audit）

![image-20200419112310745](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112311.png)

![image-20200419112159299](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112200.png)

![image-20200419112214425](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112215.png)

> 可以被审计的事件：

![image-20200419112447681](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112449.png)

> 审计日志管理：

![image-20200419112525289](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112526.png)

> 审计功能设置：

![image-20200419112558825](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112600.png)

![image-20200419112610736](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112611.png)

![image-20200419112623185](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112624.png)



### 4.5  数据加密

![image-20200419112755532](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112756.png)

> 存储加密：

![image-20200419112855760](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112857.png)

> 传输加密：

![image-20200419112916778](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419112917.png)

![image-20200419113021581](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419113022.png)

![image-20200419113114171](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419113115.png)

![image-20200419113125272](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419113126.png)

### 4.6  其他安全性保护

![image-20200419113232148](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419113233.png)

![image-20200419115428978](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419115430.png)

![image-20200419113147789](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419113148.png)



## 5 数据库完整性

![image-20200419135312972](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135314.png)

![image-20200419135610305](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135611.png)

![image-20200419135711050](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135712.png)

![image-20200419135752242](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135754.png)

![image-20200419135810404](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135811.png)

![image-20200419135926400](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419135927.png)

### 5.1  实体完整性

#### 5.1.1 实体完整性定义

![image-20200419140313050](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140314.png)

![image-20200419140427057](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140428.png)

![image-20200419140439376](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140440.png)

![image-20200419140451745](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140453.png)



#### 5.1.2 实体完整性检查和违约处理

![image-20200419140514507](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140515.png)

![image-20200419140532564](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140533.png)

![image-20200419140545307](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140546.png)

![image-20200419140600658](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140601.png)



### 5.2  参照完整性

#### 5.2.1 参照完整性定义

![image-20200419140648495](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140649.png)

![image-20200419142335708](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419142337.png)

![image-20200419140703195](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140704.png)

![image-20200419142441192](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419142442.png)

#### 5.2.2 参照完整性检查和违约处理

![image-20200419140720571](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140722.png)

![image-20200419140733536](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140741.png)

![image-20200419140756754](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140757.png)

![image-20200419140809328](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140810.png)

![image-20200419140820199](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140821.png)

![image-20200419140832289](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140833.png)

![image-20200419140843451](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140844.png)

![image-20200419140855591](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140856.png)



### 5.3  用户定义的完整性

![image-20200419140909470](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140910.png)

#### 5.3.1 属性上的约束条件

![image-20200419140942511](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140943.png)

![image-20200419140956625](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419140957.png)

![image-20200419141008333](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141009.png)

![image-20200419141028695](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141029.png)

![image-20200419141043273](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141044.png)

![image-20200419141114471](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141115.png)

#### 5.3.2 元组上的约束条件 

![image-20200419141133406](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141134.png)

![image-20200419141147314](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141148.png)

![image-20200419141157595](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141159.png)



### 5.4  完整性约束命名字句

![image-20200419141215710](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141216.png)

![image-20200419141228394](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141229.png)

![image-20200419141240548](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141241.png)

![image-20200419141252631](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141254.png)

![image-20200419141306267](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141307.png)



### 5.5  域中的完整性限制（*）



### 5.6  断言

![image-20200419141336645](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141337.png)

![image-20200419141354023](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141355.png)



![image-20200419141406790](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141407.png)

![image-20200419141418932](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141419.png)

![image-20200419141430297](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141431.png)



### 5.7  触发器

![image-20200419141448454](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141449.png)

#### 5.7.1 定义触发器 

![image-20200419141531222](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141532.png)

![image-20200419141544996](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141546.png)

![image-20200419141558044](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141559.png)

![image-20200419141611545](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141612.png)

![image-20200419141623801](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141624.png)

![image-20200419141633569](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141634.png)

![image-20200419141647951](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141648.png)

![image-20200419141659256](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141700.png)

![image-20200419141712334](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141713.png)



#### 5.7.2 激活触发器 

![image-20200419141726834](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141728.png)



#### 5.7.3 删除触发器

![image-20200419141742953](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141744.png)



> 总结：

![image-20200419141812128](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419141814.png)

## 6 关系数据理论

### 6.1 问题的提出

![image-20200419144356415](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144357.png)

> 1.问题：什么是一个好的数据库逻辑设计？

![image-20200419145029022](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145030.png)

![image-20200419145047781](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145049.png)

举例：

![image-20200419144610912](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144612.png)

![image-20200419144631941](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144633.png)

> 以上关系模式存在的问题：

![image-20200419144713989](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144715.png)

![image-20200419144826086](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144827.png)

![image-20200419144923509](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419144924.png)

> 2.什么是数据依赖

![image-20200419145441902](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145443.png)

![image-20200419145458038](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145459.png)

![image-20200419145529001](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145530.png)

> 重点掌握函数依赖！

![image-20200419145214894](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145216.png)

举例：

![image-20200419145331111](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145332.png)

![image-20200419145609440](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145610.png)

![image-20200419145620758](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145621.png)

![image-20200419145634630](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145635.png)

> 3.关系模式的简化表示：

![image-20200419145913251](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419145914.png)

![image-20200419150010323](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200419150011.png)

### 6.2 规范化

#### 6.2.1  函数依赖

> 函数依赖

![image-20200420130945976](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420130956.png)

![image-20200420131023553](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420131024.png)

![image-20200420131057770](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420131058.png)

![image-20200420175048056](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420175049.png)



> 平凡函数依赖与非平凡函数依赖

![image-20200420175213046](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420175214.png)



> 完全函数依赖与部分函数依赖

![image-20200420175335206](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420175336.png)



> 传递函数依赖

![image-20200420175504897](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420175506.png)



#### 6.2.2  码

![image-20200420175906734](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420175908.png)

![image-20200420180008739](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180010.png)

> 外部码——外码

![image-20200420180145413](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180146.png)



#### 6.2.3  范式

![image-20200420180428279](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180429.png)

![image-20200420180455505](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180456.png)

> 第一范式

![image-20200420180629195](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180630.png)

#### 6.2.4  2NF

> 第二范式

![image-20200420180822542](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180823.png)

![image-20200420180852916](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180854.png)

![image-20200420180925279](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420180926.png)

![image-20200420181000812](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181001.png)

![image-20200420181028336](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181029.png)

![image-20200420181046488](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181047.png)

![image-20200420181103728](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181104.png)

![image-20200420181218112](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181219.png)

![image-20200420181159247](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181200.png)

![image-20200420181252607](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181253.png)

![image-20200420181359402](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181400.png)



#### 6.2.5  3NF

> 第三范式

![image-20200420181625552](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181626.png)

![image-20200420181700223](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181701.png)

![image-20200420181743763](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181744.png)

![image-20200420181757361](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181758.png)

![image-20200420181814151](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181815.png)

![image-20200420181842624](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181844.png)

![image-20200420181904795](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181905.png)

![image-20200420181946888](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420181947.png)

![image-20200420182045261](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182046.png)

![image-20200420182115855](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182116.png)

> 3 NF 的定义

![image-20200420182149743](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182151.png)

![image-20200420182326984](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182328.png)



#### 6.2.6  BCNF

> BC 范式：修正的第三范式

例子：

![image-20200420182527786](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182529.png)

![image-20200420182707196](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182708.png)

![image-20200420182749268](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182750.png)

![image-20200420182809008](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420182810.png)

> BC 范式

![image-20200420183426239](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183427.png)

![image-20200420183505918](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183506.png)



#### 6.2.7  多值依赖

![image-20200420183922243](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183923.png)

![image-20200420183934525](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183935.png)

![image-20200420183944590](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183945.png)

![image-20200420183959401](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184000.png)

![image-20200420184016026](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184016.png)

![image-20200420184025434](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184026.png)

![image-20200420184036777](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184037.png)

![image-20200420184048750](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184049.png)

![image-20200420184100834](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184102.png)

![image-20200420184114632](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184115.png)

![image-20200420184126027](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184126.png)

![image-20200420184137855](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184138.png)

![image-20200420184148932](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184149.png)

![image-20200420184158971](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184200.png)

![image-20200420184209253](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184210.png)

![image-20200420184218479](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184219.png)

#### 6.2.8  4NF

![image-20200420184229093](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184230.png)

![image-20200420184240677](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184241.png)



#### 6.2.9 规范化

![image-20200420183620315](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183621.png)

![image-20200420183636769](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183638.png)

![image-20200420183731210](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420183732.png)



### 6.3 数据依赖的公理系统

![image-20200420184311005](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184312.png)

![image-20200420184323694](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184324.png)

![image-20200420184332071](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184333.png)

![image-20200420184342031](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184342.png)

![image-20200420184350587](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184351.png)

![image-20200420184359634](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184400.png)

![image-20200420184412115](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184413.png)

![image-20200420184421129](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184422.png)

![image-20200420184430820](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184431.png)

![image-20200420184440591](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184441.png)

![image-20200420184453187](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184454.png)

![image-20200420184505600](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184506.png)

![image-20200420184518870](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184519.png)

![image-20200420184531398](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184532.png)

![image-20200420184543992](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184545.png)

![image-20200420184556653](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184557.png)

![image-20200420184610338](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184611.png)

![image-20200420184619888](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184620.png)

![image-20200420184630901](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184632.png)

![image-20200420184643757](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184644.png)

![image-20200420184652925](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184653.png)

![image-20200420184717256](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184718.png)

![image-20200420184728322](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184729.png)

![image-20200420184740283](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184741.png)

![image-20200420184753732](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184754.png)

![image-20200420184803740](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184804.png)

![image-20200420184815060](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184816.png)

![image-20200420184824831](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184825.png)

![image-20200420184835862](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184836.png)

![image-20200420184844366](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184845.png)

![image-20200420184854292](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184855.png)

![image-20200420184903160](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184904.png)



### 6.4 模式的分解

#### 6.4.1 模式分解的 3 个定义

![image-20200420185323023](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420185324.png)

![image-20200420185846466](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420185847.png)

![image-20200420185900512](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420185901.png)

举例：

![image-20200420185947546](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420185948.png)

![image-20200420190002332](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190003.png)

![image-20200420190031531](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190032.png)

![image-20200420190054537](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190055.png)

![image-20200420190112180](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190113.png)

![image-20200420190133429](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190134.png)

![image-20200420190219652](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190220.png)

![image-20200420190254452](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190255.png)

![image-20200420190309730](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190310.png)



#### 6.4.2 分解的无损连接性和保持函数依赖性

![image-20200420190336336](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190337.png)

![image-20200420190418609](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190420.png)

![image-20200420190435877](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190437.png)



#### 6.4.3 模式分解的算法

![image-20200420190520883](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190521.png)

![image-20200420190541939](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190543.png)



> 小结

![image-20200420184927321](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184928.png)

![image-20200420184940362](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184941.png)

![image-20200420184951883](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420184953.png)

![image-20200420190636187](https://gitee.com/wugenqiang/PictureBed/raw/master/CS-Notes/20200420190637.png)



## 7 数据库设计

> 基于数据库管理的关系型数据库的设计



## 8 数据库编程



## 9 关系查询处理和查询优化



## 10 数据库恢复技术



## 11 并发控制









# SQL



# 



# 





# 九、过滤

不进行过滤的数据非常大，导致通过网络传输了多余的数据，从而浪费了网络带宽。因此尽量使用 SQL 语句来过滤不必要的数据，而不是传输所有的数据到客户端中然后由客户端进行过滤。

```sql
SELECT *
FROM mytable
WHERE col IS NULL;
```

下表显示了 WHERE 子句可用的操作符

|   操作符    |     说明     |
| :---------: | :----------: |
|      =      |     等于     |
|    &lt;     |     小于     |
|    &gt;     |     大于     |
| &lt;&gt; != |    不等于    |
| &lt;= !&gt; |   小于等于   |
| &gt;= !&lt; |   大于等于   |
|   BETWEEN   | 在两个值之间 |
|   IS NULL   |  为 NULL 值  |

应该注意到，NULL 与 0、空字符串都不同。

**AND 和 OR**  用于连接多个过滤条件。优先处理 AND，当一个过滤表达式涉及到多个 AND 和 OR 时，可以使用 () 来决定优先级，使得优先级关系更清晰。

**IN**  操作符用于匹配一组值，其后也可以接一个 SELECT 子句，从而匹配子查询得到的一组值。

**NOT**  操作符用于否定一个条件。

# 十、通配符

通配符也是用在过滤语句中，但它只能用于文本字段。

-  **%**  匹配 >=0 个任意字符；

-  **\_**  匹配 ==1 个任意字符；

-  **[ ]**  可以匹配集合内的字符，例如 [ab] 将匹配字符 a 或者 b。用脱字符 ^ 可以对其进行否定，也就是不匹配集合内的字符。

使用 Like 来进行通配符匹配。

```sql
SELECT *
FROM mytable
WHERE col LIKE '[^AB]%'; -- 不以 A 和 B 开头的任意文本
```

不要滥用通配符，通配符位于开头处匹配会非常慢。

# 十一、计算字段

在数据库服务器上完成数据的转换和格式化的工作往往比客户端上快得多，并且转换和格式化后的数据量更少的话可以减少网络通信量。

计算字段通常需要使用  **AS**  来取别名，否则输出的时候字段名为计算表达式。

```sql
SELECT col1 * col2 AS alias
FROM mytable;
```

**CONCAT()**  用于连接两个字段。许多数据库会使用空格把一个值填充为列宽，因此连接的结果会出现一些不必要的空格，使用 **TRIM()** 可以去除首尾空格。

```sql
SELECT CONCAT(TRIM(col1), '(', TRIM(col2), ')') AS concat_col
FROM mytable;
```

# 十二、函数

各个 DBMS 的函数都是不相同的，因此不可移植，以下主要是 MySQL 的函数。

## 汇总

|  函 数  |      说 明       |
| :-----: | :--------------: |
|  AVG()  | 返回某列的平均值 |
| COUNT() |  返回某列的行数  |
|  MAX()  | 返回某列的最大值 |
|  MIN()  | 返回某列的最小值 |
|  SUM()  |  返回某列值之和  |

AVG() 会忽略 NULL 行。

使用 DISTINCT 可以让汇总函数值汇总不同的值。

```sql
SELECT AVG(DISTINCT col1) AS avg_col
FROM mytable;
```

## 文本处理

|   函数    |      说明      |
| :-------: | :------------: |
|  LEFT()   |   左边的字符   |
|  RIGHT()  |   右边的字符   |
|  LOWER()  | 转换为小写字符 |
|  UPPER()  | 转换为大写字符 |
|  LTRIM()  | 去除左边的空格 |
|  RTRIM()  | 去除右边的空格 |
| LENGTH()  |      长度      |
| SOUNDEX() |  转换为语音值  |

其中， **SOUNDEX()**  可以将一个字符串转换为描述其语音表示的字母数字模式。

```sql
SELECT *
FROM mytable
WHERE SOUNDEX(col1) = SOUNDEX('apple')
```

## 日期和时间处理

- 日期格式：YYYY-MM-DD
- 时间格式：HH:MM:SS

|     函 数     |             说 明              |
| :-----------: | :----------------------------: |
|   AddDate()   |    增加一个日期（天、周等）    |
|   AddTime()   |    增加一个时间（时、分等）    |
|   CurDate()   |          返回当前日期          |
|   CurTime()   |          返回当前时间          |
|    Date()     |     返回日期时间的日期部分     |
|  DateDiff()   |        计算两个日期之差        |
|  Date_Add()   |     高度灵活的日期运算函数     |
| Date_Format() |  返回一个格式化的日期或时间串  |
|     Day()     |     返回一个日期的天数部分     |
|  DayOfWeek()  | 对于一个日期，返回对应的星期几 |
|    Hour()     |     返回一个时间的小时部分     |
|   Minute()    |     返回一个时间的分钟部分     |
|    Month()    |     返回一个日期的月份部分     |
|     Now()     |       返回当前日期和时间       |
|   Second()    |      返回一个时间的秒部分      |
|    Time()     |   返回一个日期时间的时间部分   |
|    Year()     |     返回一个日期的年份部分     |

```sql
mysql> SELECT NOW();
```

```
2018-4-14 20:25:11
```

## 数值处理

|  函数  |  说明  |
| :----: | :----: |
| SIN()  |  正弦  |
| COS()  |  余弦  |
| TAN()  |  正切  |
| ABS()  | 绝对值 |
| SQRT() | 平方根 |
| MOD()  |  余数  |
| EXP()  |  指数  |
|  PI()  | 圆周率 |
| RAND() | 随机数 |

# 十三、分组

分组就是把具有相同的数据值的行放在同一组中。

可以对同一分组数据使用汇总函数进行处理，例如求分组数据的平均值等。

指定的分组字段除了能按该字段进行分组，也会自动按该字段进行排序。

```sql
SELECT col, COUNT(*) AS num
FROM mytable
GROUP BY col;
```

GROUP BY 自动按分组字段进行排序，ORDER BY 也可以按汇总字段来进行排序。

```sql
SELECT col, COUNT(*) AS num
FROM mytable
GROUP BY col
ORDER BY num;
```

WHERE 过滤行，HAVING 过滤分组，行过滤应当先于分组过滤。

```sql
SELECT col, COUNT(*) AS num
FROM mytable
WHERE col > 2
GROUP BY col
HAVING num >= 2;
```

分组规定：

- GROUP BY 子句出现在 WHERE 子句之后，ORDER BY 子句之前；
- 除了汇总字段外，SELECT 语句中的每一字段都必须在 GROUP BY 子句中给出；
- NULL 的行会单独分为一组；
- 大多数 SQL 实现不支持 GROUP BY 列具有可变长度的数据类型。

# 十四、子查询

子查询中只能返回一个字段的数据。

可以将子查询的结果作为 WHRER 语句的过滤条件：

```sql
SELECT *
FROM mytable1
WHERE col1 IN (SELECT col2
               FROM mytable2);
```

下面的语句可以检索出客户的订单数量，子查询语句会对第一个查询检索出的每个客户执行一次：

```sql
SELECT cust_name, (SELECT COUNT(*)
                   FROM Orders
                   WHERE Orders.cust_id = Customers.cust_id)
                   AS orders_num
FROM Customers
ORDER BY cust_name;
```

# 十五、连接

连接用于连接多个表，使用 JOIN 关键字，并且条件语句使用 ON 而不是 WHERE。

连接可以替换子查询，并且比子查询的效率一般会更快。

可以用 AS 给列名、计算字段和表名取别名，给表名取别名是为了简化 SQL 语句以及连接相同表。

## 内连接

内连接又称等值连接，使用 INNER JOIN 关键字。

```sql
SELECT A.value, B.value
FROM tablea AS A INNER JOIN tableb AS B
ON A.key = B.key;
```

可以不明确使用 INNER JOIN，而使用普通查询并在 WHERE 中将两个表中要连接的列用等值方法连接起来。

```sql
SELECT A.value, B.value
FROM tablea AS A, tableb AS B
WHERE A.key = B.key;
```

在没有条件语句的情况下返回笛卡尔积。

## 自连接

自连接可以看成内连接的一种，只是连接的表是自身而已。

一张员工表，包含员工姓名和员工所属部门，要找出与 Jim 处在同一部门的所有员工姓名。

子查询版本

```sql
SELECT name
FROM employee
WHERE department = (
      SELECT department
      FROM employee
      WHERE name = "Jim");
```

自连接版本

```sql
SELECT e1.name
FROM employee AS e1 INNER JOIN employee AS e2
ON e1.department = e2.department
      AND e2.name = "Jim";
```

## 自然连接

自然连接是把同名列通过等值测试连接起来的，同名列可以有多个。

内连接和自然连接的区别：内连接提供连接的列，而自然连接自动连接所有同名列。

```sql
SELECT A.value, B.value
FROM tablea AS A NATURAL JOIN tableb AS B;
```

## 外连接

外连接保留了没有关联的那些行。分为左外连接，右外连接以及全外连接，左外连接就是保留左表没有关联的行。

检索所有顾客的订单信息，包括还没有订单信息的顾客。

```sql
SELECT Customers.cust_id, Orders.order_num
FROM Customers LEFT OUTER JOIN Orders
ON Customers.cust_id = Orders.cust_id;
```

customers 表：

| cust_id | cust_name |
| :-----: | :-------: |
|    1    |     a     |
|    2    |     b     |
|    3    |     c     |

orders 表：

| order_id | cust_id |
| :------: | :-----: |
|    1     |    1    |
|    2     |    1    |
|    3     |    3    |
|    4     |    3    |

结果：

| cust_id | cust_name | order_id |
| :-----: | :-------: | :------: |
|    1    |     a     |    1     |
|    1    |     a     |    2     |
|    3    |     c     |    3     |
|    3    |     c     |    4     |
|    2    |     b     |   Null   |

# 十六、组合查询

使用  **UNION**  来组合两个查询，如果第一个查询返回 M 行，第二个查询返回 N 行，那么组合查询的结果一般为 M+N 行。

每个查询必须包含相同的列、表达式和聚集函数。

默认会去除相同行，如果需要保留相同行，使用 UNION ALL。

只能包含一个 ORDER BY 子句，并且必须位于语句的最后。

```sql
SELECT col
FROM mytable
WHERE col = 1
UNION
SELECT col
FROM mytable
WHERE col =2;
```

# 十七、视图

视图是虚拟的表，本身不包含数据，也就不能对其进行索引操作。

对视图的操作和对普通表的操作一样。

视图具有如下好处：

- 简化复杂的 SQL 操作，比如复杂的连接；
- 只使用实际表的一部分数据；
- 通过只给用户访问视图的权限，保证数据的安全性；
- 更改数据格式和表示。

```sql
CREATE VIEW myview AS
SELECT Concat(col1, col2) AS concat_col, col3*col4 AS compute_col
FROM mytable
WHERE col5 = val;
```

# 十八、存储过程

存储过程可以看成是对一系列 SQL 操作的批处理。

使用存储过程的好处：

- 代码封装，保证了一定的安全性；
- 代码复用；
- 由于是预先编译，因此具有很高的性能。

命令行中创建存储过程需要自定义分隔符，因为命令行是以 ; 为结束符，而存储过程中也包含了分号，因此会错误把这部分分号当成是结束符，造成语法错误。

包含 in、out 和 inout 三种参数。

给变量赋值都需要用 select into 语句。

每次只能给一个变量赋值，不支持集合的操作。

```sql
delimiter //

create procedure myprocedure( out ret int )
    begin
        declare y int;
        select sum(col1)
        from mytable
        into y;
        select y*y into ret;
    end //

delimiter ;
```

```sql
call myprocedure(@ret);
select @ret;
```

# 十九、游标

在存储过程中使用游标可以对一个结果集进行移动遍历。

游标主要用于交互式应用，其中用户需要对数据集中的任意行进行浏览和修改。

使用游标的四个步骤：

1. 声明游标，这个过程没有实际检索出数据；
2. 打开游标；
3. 取出数据；
4. 关闭游标；

```sql
delimiter //
create procedure myprocedure(out ret int)
    begin
        declare done boolean default 0;

        declare mycursor cursor for
        select col1 from mytable;
        # 定义了一个 continue handler，当 sqlstate '02000' 这个条件出现时，会执行 set done = 1
        declare continue handler for sqlstate '02000' set done = 1;

        open mycursor;

        repeat
            fetch mycursor into ret;
            select ret;
        until done end repeat;

        close mycursor;
    end //
 delimiter ;
```

# 二十、触发器

触发器会在某个表执行以下语句时而自动执行：DELETE、INSERT、UPDATE。

触发器必须指定在语句执行之前还是之后自动执行，之前执行使用 BEFORE 关键字，之后执行使用 AFTER 关键字。BEFORE 用于数据验证和净化，AFTER 用于审计跟踪，将修改记录到另外一张表中。

INSERT 触发器包含一个名为 NEW 的虚拟表。

```sql
CREATE TRIGGER mytrigger AFTER INSERT ON mytable
FOR EACH ROW SELECT NEW.col into @result;

SELECT @result; -- 获取结果
```

DELETE 触发器包含一个名为 OLD 的虚拟表，并且是只读的。

UPDATE 触发器包含一个名为 NEW 和一个名为 OLD 的虚拟表，其中 NEW 是可以被修改的，而 OLD 是只读的。

MySQL 不允许在触发器中使用 CALL 语句，也就是不能调用存储过程。

# 二十一、事务管理

基本术语：

- 事务（transaction）指一组 SQL 语句；
- 回退（rollback）指撤销指定 SQL 语句的过程；
- 提交（commit）指将未存储的 SQL 语句结果写入数据库表；
- 保留点（savepoint）指事务处理中设置的临时占位符（placeholder），你可以对它发布回退（与回退整个事务处理不同）。

不能回退 SELECT 语句，回退 SELECT 语句也没意义；也不能回退 CREATE 和 DROP 语句。

MySQL 的事务提交默认是隐式提交，每执行一条语句就把这条语句当成一个事务然后进行提交。当出现 START TRANSACTION 语句时，会关闭隐式提交；当 COMMIT 或 ROLLBACK 语句执行后，事务会自动关闭，重新恢复隐式提交。

通过设置 autocommit 为 0 可以取消自动提交；autocommit 标记是针对每个连接而不是针对服务器的。

如果没有设置保留点，ROLLBACK 会回退到 START TRANSACTION 语句处；如果设置了保留点，并且在 ROLLBACK 中指定该保留点，则会回退到该保留点。

```sql
START TRANSACTION
// ...
SAVEPOINT delete1
// ...
ROLLBACK TO delete1
// ...
COMMIT
```

# 二十二、字符集

基本术语：

- 字符集为字母和符号的集合；
- 编码为某个字符集成员的内部表示；
- 校对字符指定如何比较，主要用于排序和分组。

除了给表指定字符集和校对外，也可以给列指定：

```sql
CREATE TABLE mytable
(col VARCHAR(10) CHARACTER SET latin COLLATE latin1_general_ci )
DEFAULT CHARACTER SET hebrew COLLATE hebrew_general_ci;
```

可以在排序、分组时指定校对：

```sql
SELECT *
FROM mytable
ORDER BY col COLLATE latin1_general_ci;
```

# 二十三、权限管理

MySQL 的账户信息保存在 mysql 这个数据库中。

```sql
USE mysql;
SELECT user FROM user;
```

**创建账户** 

新创建的账户没有任何权限。

```sql
CREATE USER myuser IDENTIFIED BY 'mypassword';
```

**修改账户名** 

```sql
RENAME myuser TO newuser;
```

**删除账户** 

```sql
DROP USER myuser;
```

**查看权限** 

```sql
SHOW GRANTS FOR myuser;
```

**授予权限** 

账户用 username@host 的形式定义，username@% 使用的是默认主机名。

```sql
GRANT SELECT, INSERT ON mydatabase.* TO myuser;
```

**删除权限** 

GRANT 和 REVOKE 可在几个层次上控制访问权限：

- 整个服务器，使用 GRANT ALL 和 REVOKE ALL；
- 整个数据库，使用 ON database.\*；
- 特定的表，使用 ON database.table；
- 特定的列；
- 特定的存储过程。

```sql
REVOKE SELECT, INSERT ON mydatabase.* FROM myuser;
```

**更改密码** 

必须使用 Password() 函数

```sql
SET PASSWROD FOR myuser = Password('new_password');
```

